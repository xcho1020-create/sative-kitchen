// App Logic async function apiCall(action, data = null, method = 'GET') { const url = data ? `${API_URL}?action=${action}` : `${API_URL}?action=${action}`; const options = { method: method, headers: { 'Content-Type': 'application/json' } }; if (method === 'POST' && data) { options.body = JSON.stringify(data); } try { const response = await fetch(url, options); const result = await response.json(); return result; } catch (error) { console.error('API Error:', error); return { error: error.message }; } } // Auth functions function login(role, password) { if (AUTH[role] === password) { currentUser = role; currentRole = role; localStorage.setItem('user', role); showPage(role === 'admin' ? 'admin' : role === 'manager' ? 'manager' : 'home'); return true; } alert('invalid password'); return false; } function logout() { currentUser = null; currentRole = null; localStorage.removeItem('user'); showPage('login'); } function checkAuth() { const saved = localStorage.getItem('user'); if (saved && AUTH[saved]) { currentUser = saved; currentRole = saved; return true; } return false; } // Page navigation function showPage(page) { document.querySelectorAll('[data-page]').forEach(el => { el.style.display = 'none'; }); const target = document.querySelector(`[data-page="${page}"]`); if (target) { target.style.display = 'block'; if (page === 'home') loadDeliveries(); if (page === 'admin') loadAdminProducts(); } } // Load deliveries list async function loadDeliveries() { const result = await apiCall('getDeliveries'); if (!result.success) { document.getElementById('deliveriesList').innerHTML = '\n\nerror loading'; return; } const html = result.data.map(d => `\n\nno deliveries'; } // Load admin products async function loadAdminProducts() { const result = await apiCall('getProducts'); if (!result.success) { document.getElementById('productsList').innerHTML = '\n\nerror'; return; } const html = result.data.map(p => `
